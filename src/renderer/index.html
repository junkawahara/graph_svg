<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'">
  <title>DrawSVG</title>
</head>
<body>
  <div id="app">
    <!-- Toolbar -->
    <div id="toolbar">
      <div class="tool-group">
        <button id="tool-select" class="tool-btn active" title="Select (V)">
          <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 1L2 13L5.5 9.5L8 15L10 14L7.5 8.5L12 8.5L2 1Z" fill="currentColor"/>
          </svg>
        </button>
        <button id="tool-pan" class="tool-btn" title="Pan (H)">
          <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 7V2.5C6 1.67 6.67 1 7.5 1C8.33 1 9 1.67 9 2.5V7M9 5V1.5C9 0.67 9.67 0 10.5 0C11.33 0 12 0.67 12 1.5V7M6 7V5.5C6 4.67 5.33 4 4.5 4C3.67 4 3 4.67 3 5.5V10C3 13 5 15 8 15C11 15 13 13 13 10V7C13 6.17 12.33 5.5 11.5 5.5C10.67 5.5 10 6.17 10 7" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button id="tool-rotate" class="tool-btn" title="Rotate (O)">
          <span class="icon">&#8634;</span>
        </button>
        <button id="tool-zoom" class="tool-btn" title="Zoom (Z)" style="margin-right: 12px;">
          <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="6.5" cy="6.5" r="4.5" stroke="currentColor" stroke-width="1.5"/>
            <line x1="10" y1="10" x2="14.5" y2="14.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
        <button id="tool-line" class="tool-btn" title="Line (L)">
          <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <line x1="2" y1="14" x2="14" y2="2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
        <button id="tool-ellipse" class="tool-btn" title="Ellipse (E)">
          <span class="icon">&#9711;</span>
        </button>
        <button id="tool-rectangle" class="tool-btn" title="Rectangle (R)">
          <span class="icon">&#9645;</span>
        </button>
        <button id="tool-polygon" class="tool-btn" title="Polygon (5)">
          <span class="icon">&#11039;</span>
        </button>
        <button id="tool-polyline" class="tool-btn" title="Polyline (Y)">
          <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 13L6 5L10 9L14 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button id="tool-path" class="tool-btn" title="Path (P)">
          <span class="icon">&#8766;</span>
        </button>
        <button id="tool-add-path-point" class="tool-btn" title="Add Path Point (+)">
          <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 12 Q8 4 14 12" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <circle cx="8" cy="8" r="3" fill="currentColor"/>
            <line x1="8" y1="5.5" x2="8" y2="10.5" stroke="white" stroke-width="1.5"/>
            <line x1="5.5" y1="8" x2="10.5" y2="8" stroke="white" stroke-width="1.5"/>
          </svg>
        </button>
        <button id="tool-delete-path-point" class="tool-btn" title="Delete Path Point (-)">
          <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 12 Q8 4 14 12" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <circle cx="8" cy="8" r="3.5" fill="#e74c3c"/>
            <line x1="6" y1="6" x2="10" y2="10" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
            <line x1="10" y1="6" x2="6" y2="10" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
        <button id="tool-text" class="tool-btn" title="Text (T)" style="margin-right: 12px;">
          <span class="icon">T</span>
        </button>
        <button id="tool-node" class="tool-btn" title="Node (N)">
          <span class="icon">&#9673;</span>
        </button>
        <button id="tool-edge" class="tool-btn" title="Edge (W)">
          <span class="icon">&#8594;</span>
        </button>
        <button id="tool-delete-node" class="tool-btn" title="Delete Node">
          <span class="icon">&#9673;&#10005;</span>
        </button>
        <button id="tool-delete-edge" class="tool-btn" title="Delete Edge">
          <span class="icon">&#8594;&#10005;</span>
        </button>
        <button id="btn-directed" class="tool-btn" title="Toggle Directed Edge">
          <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <line x1="2" y1="5" x2="14" y2="5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M2 11L11 11L8 8M11 11L8 14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button id="btn-auto-layout" class="tool-btn" title="Auto Layout">
          <span class="icon">&#9635;</span>
        </button>
      </div>
    </div>

    <!-- Main content area -->
    <div id="main-content">
      <!-- Canvas -->
      <div id="canvas-container">
        <svg id="canvas" xmlns="http://www.w3.org/2000/svg">
          <!-- SVG shapes will be rendered here -->
        </svg>
      </div>

      <!-- Sidebar -->
      <div id="sidebar">
        <h3>Properties</h3>

        <!-- Style Class selector (shown when shapes are selected) -->
        <div id="style-class-section" class="property-section" style="display: none;">
          <label class="section-label">Style Class</label>
          <div class="class-selector">
            <select id="prop-style-class">
              <option value="">(none)</option>
            </select>
            <button id="btn-save-class" class="class-btn" title="Save current style as new class">+</button>
            <button id="btn-manage-classes" class="class-btn" title="Manage style classes">⚙</button>
          </div>
        </div>

        <!-- Default Node Size (shown when node tool is active) -->
        <div id="default-node-size-section" class="property-section" style="display: none;">
          <label class="section-label">Default Node Size</label>
          <div class="property-row">
            <div class="property-group small">
              <label>RX</label>
              <input type="number" id="prop-default-node-rx" step="1" min="5" value="20">
            </div>
            <div class="property-group small">
              <label>RY</label>
              <input type="number" id="prop-default-node-ry" step="1" min="5" value="20">
            </div>
          </div>
        </div>

        <!-- Position/Size properties (hidden by default) -->
        <!-- Line position -->
        <div id="line-position" class="position-section" style="display: none;">
          <div class="property-row">
            <div class="property-group small">
              <label>X1</label>
              <input type="number" id="prop-line-x1" step="any">
            </div>
            <div class="property-group small">
              <label>Y1</label>
              <input type="number" id="prop-line-y1" step="any">
            </div>
          </div>
          <div class="property-row">
            <div class="property-group small">
              <label>X2</label>
              <input type="number" id="prop-line-x2" step="any">
            </div>
            <div class="property-group small">
              <label>Y2</label>
              <input type="number" id="prop-line-y2" step="any">
            </div>
          </div>
        </div>

        <!-- Ellipse position -->
        <div id="ellipse-position" class="position-section" style="display: none;">
          <div class="property-row">
            <div class="property-group small">
              <label>CX</label>
              <input type="number" id="prop-ellipse-cx" step="any">
            </div>
            <div class="property-group small">
              <label>CY</label>
              <input type="number" id="prop-ellipse-cy" step="any">
            </div>
          </div>
          <div class="property-row">
            <div class="property-group small">
              <label>RX</label>
              <input type="number" id="prop-ellipse-rx" step="any" min="1">
            </div>
            <div class="property-group small">
              <label>RY</label>
              <input type="number" id="prop-ellipse-ry" step="any" min="1">
            </div>
          </div>
        </div>

        <!-- Rectangle position -->
        <div id="rectangle-position" class="position-section" style="display: none;">
          <div class="property-row">
            <div class="property-group small">
              <label>X</label>
              <input type="number" id="prop-rect-x" step="any">
            </div>
            <div class="property-group small">
              <label>Y</label>
              <input type="number" id="prop-rect-y" step="any">
            </div>
          </div>
          <div class="property-row">
            <div class="property-group small">
              <label>W</label>
              <input type="number" id="prop-rect-width" step="any" min="1">
            </div>
            <div class="property-group small">
              <label>H</label>
              <input type="number" id="prop-rect-height" step="any" min="1">
            </div>
          </div>
        </div>

        <!-- Text position -->
        <div id="text-position" class="position-section" style="display: none;">
          <div class="property-row">
            <div class="property-group small">
              <label>X</label>
              <input type="number" id="prop-text-x" step="any">
            </div>
            <div class="property-group small">
              <label>Y</label>
              <input type="number" id="prop-text-y" step="any">
            </div>
          </div>
        </div>

        <!-- Node position -->
        <div id="node-position" class="position-section" style="display: none;">
          <div class="property-row">
            <div class="property-group small">
              <label>CX</label>
              <input type="number" id="prop-node-cx" step="any">
            </div>
            <div class="property-group small">
              <label>CY</label>
              <input type="number" id="prop-node-cy" step="any">
            </div>
          </div>
          <div class="property-row">
            <div class="property-group small">
              <label>RX</label>
              <input type="number" id="prop-node-rx" step="any" min="1">
            </div>
            <div class="property-group small">
              <label>RY</label>
              <input type="number" id="prop-node-ry" step="any" min="1">
            </div>
          </div>
        </div>

        <!-- Text-specific properties (hidden by default) -->
        <div id="text-properties" style="display: none;">
          <div class="property-group">
            <label>Content</label>
            <textarea id="prop-text-content" placeholder="Text content" rows="3"></textarea>
          </div>
          <div class="property-group">
            <label>Font Size</label>
            <input type="number" id="prop-font-size" value="24" min="8" max="200">
          </div>
          <div class="property-group">
            <label>Font Family</label>
            <select id="prop-font-family">
              <option value="Arial">Arial</option>
              <option value="Times New Roman">Times New Roman</option>
              <option value="Georgia">Georgia</option>
              <option value="Verdana">Verdana</option>
              <option value="Courier New">Courier New</option>
              <option value="serif">Serif</option>
              <option value="sans-serif">Sans-serif</option>
              <option value="monospace">Monospace</option>
            </select>
          </div>
          <div class="property-group">
            <label>Alignment</label>
            <select id="prop-text-anchor">
              <option value="start">Left</option>
              <option value="middle">Center</option>
              <option value="end">Right</option>
            </select>
          </div>
          <div class="property-group">
            <label>Line Height</label>
            <select id="prop-line-height">
              <option value="1">1.0</option>
              <option value="1.2" selected>1.2</option>
              <option value="1.5">1.5</option>
              <option value="2">2.0</option>
            </select>
          </div>
          <div class="property-group">
            <label>Style</label>
            <div class="text-style-buttons">
              <button type="button" id="prop-font-bold-btn" class="style-btn" title="Bold">B</button>
              <button type="button" id="prop-font-italic-btn" class="style-btn" title="Italic"><em>I</em></button>
              <button type="button" id="prop-text-underline-btn" class="style-btn" title="Underline"><u>U</u></button>
              <button type="button" id="prop-text-strikethrough-btn" class="style-btn" title="Strikethrough"><s>S</s></button>
            </div>
          </div>
          <!-- Rich Text Range Styling -->
          <div id="rich-text-controls" class="rich-text-section">
            <label class="section-label">Range Style</label>
            <div class="range-inputs">
              <div class="property-group small">
                <label>From</label>
                <input type="number" id="prop-range-start" min="0" step="1" value="0">
              </div>
              <div class="property-group small">
                <label>To</label>
                <input type="number" id="prop-range-end" min="0" step="1" value="0">
              </div>
              <span class="range-hint">(auto)</span>
            </div>
            <div class="range-style-buttons">
              <button type="button" id="prop-range-bold-btn" class="style-btn" title="Bold selection">B</button>
              <button type="button" id="prop-range-italic-btn" class="style-btn" title="Italic selection"><em>I</em></button>
              <button type="button" id="prop-range-underline-btn" class="style-btn" title="Underline selection"><u>U</u></button>
              <button type="button" id="prop-range-strikethrough-btn" class="style-btn" title="Strikethrough selection"><s>S</s></button>
              <input type="color" id="prop-range-color" value="#000000" title="Text color">
            </div>
            <button type="button" id="prop-clear-formatting-btn" class="clear-formatting-btn">Clear Formatting</button>
          </div>
        </div>

        <div class="property-group">
          <label>Fill</label>
          <div class="color-input-wrapper">
            <input type="color" id="prop-fill" value="#ffffff">
            <label class="checkbox-label">
              <input type="checkbox" id="prop-fill-none">
              None
            </label>
          </div>
        </div>

        <div class="property-group">
          <label>Stroke</label>
          <div class="color-input-wrapper">
            <input type="color" id="prop-stroke" value="#000000">
          </div>
        </div>

        <div class="property-group">
          <label>Stroke Width</label>
          <input type="number" id="prop-stroke-width" value="2" min="0" step="0.5">
        </div>

        <div class="property-group">
          <label>Opacity</label>
          <input type="range" id="prop-opacity" value="100" min="0" max="100">
          <span id="prop-opacity-value">100%</span>
        </div>

        <div class="property-group">
          <label>Stroke Style</label>
          <select id="prop-stroke-dasharray">
            <option value="">Solid</option>
            <option value="5,5">Dashed</option>
            <option value="2,2">Dotted</option>
            <option value="10,5,2,5">Dash-Dot</option>
          </select>
        </div>

        <div class="property-group">
          <label>Line Cap</label>
          <select id="prop-stroke-linecap">
            <option value="butt">Butt</option>
            <option value="round">Round</option>
            <option value="square">Square</option>
          </select>
        </div>

        <!-- Rotation property (hidden by default, shown for rotatable shapes) -->
        <div id="rotation-property" class="property-group" style="display: none;">
          <label>Rotation</label>
          <div class="rotation-input-wrapper">
            <input type="number" id="prop-rotation" value="0" min="0" max="360" step="1">
            <span>°</span>
          </div>
        </div>

        <!-- Node-specific properties (hidden by default) -->
        <div id="node-properties" style="display: none;">
          <div class="property-group">
            <label>Node Label</label>
            <input type="text" id="prop-node-label" placeholder="Label">
          </div>
          <div class="property-group">
            <label>Font Size</label>
            <input type="number" id="prop-node-font-size" value="14" min="8" max="72">
          </div>
        </div>

        <!-- Edge-specific properties (hidden by default) -->
        <div id="edge-properties" style="display: none;">
          <div class="property-group">
            <label>Direction</label>
            <select id="prop-edge-direction">
              <option value="none">Undirected</option>
              <option value="forward">Forward (→)</option>
              <option value="backward">Backward (←)</option>
            </select>
          </div>
          <div class="property-group">
            <label>Line Type</label>
            <select id="prop-edge-line-type">
              <option value="straight">Straight</option>
              <option value="curve">Curve</option>
              <option value="path">Path (editable)</option>
            </select>
          </div>
          <div id="edge-curve-amount-section" class="property-group" style="display: none;">
            <label>Curve Amount</label>
            <div style="display: flex; align-items: center; gap: 8px;">
              <input type="range" id="prop-edge-curve-amount" min="-100" max="100" value="0" style="flex: 1;">
              <span id="edge-curve-amount-value" style="min-width: 32px; text-align: right;">0</span>
            </div>
          </div>
          <div class="property-group">
            <label>Edge Label</label>
            <input type="text" id="prop-edge-label" placeholder="Label">
          </div>
        </div>

        <!-- Path-specific properties (hidden by default) -->
        <div id="path-properties" style="display: none;">
          <div class="property-group">
            <label>Path Data (d)</label>
            <textarea id="prop-path-data" placeholder="M 0 0 L 100 100" rows="4" style="font-family: monospace; font-size: 11px;"></textarea>
          </div>
        </div>

        <!-- Marker properties for Line and Path (hidden by default) -->
        <div id="marker-properties" style="display: none;">
          <div class="property-group">
            <label>Arrow Start</label>
            <select id="prop-marker-start">
              <option value="none">None</option>
              <optgroup label="Arrow (>)">
                <option value="arrow-small">Arrow - S</option>
                <option value="arrow-medium">Arrow - M</option>
                <option value="arrow-large">Arrow - L</option>
              </optgroup>
              <optgroup label="Triangle">
                <option value="triangle-small">Triangle - S</option>
                <option value="triangle-medium">Triangle - M</option>
                <option value="triangle-large">Triangle - L</option>
              </optgroup>
              <optgroup label="Circle">
                <option value="circle-small">Circle - S</option>
                <option value="circle-medium">Circle - M</option>
                <option value="circle-large">Circle - L</option>
              </optgroup>
              <optgroup label="Diamond">
                <option value="diamond-small">Diamond - S</option>
                <option value="diamond-medium">Diamond - M</option>
                <option value="diamond-large">Diamond - L</option>
              </optgroup>
            </select>
          </div>
          <div class="property-group">
            <label>Arrow End</label>
            <select id="prop-marker-end">
              <option value="none">None</option>
              <optgroup label="Arrow (>)">
                <option value="arrow-small">Arrow - S</option>
                <option value="arrow-medium">Arrow - M</option>
                <option value="arrow-large">Arrow - L</option>
              </optgroup>
              <optgroup label="Triangle">
                <option value="triangle-small">Triangle - S</option>
                <option value="triangle-medium">Triangle - M</option>
                <option value="triangle-large">Triangle - L</option>
              </optgroup>
              <optgroup label="Circle">
                <option value="circle-small">Circle - S</option>
                <option value="circle-medium">Circle - M</option>
                <option value="circle-large">Circle - L</option>
              </optgroup>
              <optgroup label="Diamond">
                <option value="diamond-small">Diamond - S</option>
                <option value="diamond-medium">Diamond - M</option>
                <option value="diamond-large">Diamond - L</option>
              </optgroup>
            </select>
          </div>
        </div>

        <!-- Canvas Size -->
        <div id="canvas-size-section" class="property-section">
          <label class="section-label">Canvas Size</label>
          <div class="property-row">
            <div class="property-group small">
              <label>W</label>
              <input type="number" id="prop-canvas-width" step="10" min="100">
            </div>
            <div class="property-group small">
              <label>H</label>
              <input type="number" id="prop-canvas-height" step="10" min="100">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Status Bar -->
    <div id="status-bar">
      <span id="status-tool" class="status-item">選択 (V)</span>
      <span class="status-separator">|</span>
      <span id="status-help" class="status-item status-help"></span>
      <span id="status-zoom" class="status-item">100%</span>
      <span class="status-separator">|</span>
      <span id="status-position" class="status-item">X: 0, Y: 0</span>
    </div>
  </div>
</body>
</html>
