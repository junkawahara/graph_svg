# Changelog

このプロジェクトの変更履歴を記録します。

## [Unreleased]

### 追加
- 図形の回転機能
  - 専用の回転ツール（Oキーまたはツールバーボタン）
  - 図形の上部中央に回転ハンドルを表示
  - ドラッグで自由回転、Shift+ドラッグで45度単位スナップ
  - サイドバーで角度を数値入力可能（0〜360度）
  - SVG transform="rotate()" 属性で回転を保存
  - 回転を考慮した当たり判定とバウンディングボックス計算
  - Undo/Redo 対応
  - Edge（グラフエッジ）は回転対象外（接続ノードに追従）

- アプリケーションメニューの日本語化と機能追加
  - 全メニュー項目を日本語に変更
  - 「ツール」メニュー追加: 全描画ツールをメニューから選択可能
  - 「配置」メニュー追加: Z-Order 操作、自動レイアウト、有向エッジ切替
  - 「編集」メニュー: 削除、グループ化/解除を追加
  - 「表示」メニュー: グリッドスナップ切替を追加

- コンテキストメニュー（右クリック）機能
  - オブジェクト上で右クリックするとコンテキストメニューが開く
  - 「SVGタグを編集」: SVG 編集ダイアログを開く
  - 「グループ化」: 複数オブジェクト選択時に表示、選択オブジェクトをグループ化
  - 「グループ化の解除」: グループオブジェクト右クリック時に表示
  - 「最前面に移動」「最背面に移動」「1つ前面へ」「1つ背面へ」: Z-Order 操作

- SVG ソース直接編集機能
  - SVG タグ（outerHTML）を直接テキストエリアで編集可能
  - テキストエリアは右端で折り返し表示
  - 編集結果を OK ボタンで即座に反映
  - Undo/Redo 対応
  - 不正な SVG はエラーメッセージを表示

- 標準 SVG path 対応
  - 標準 SVG path 要素（`d` 属性）の読み込み・書き出し対応
  - 対応コマンド: M, L, C, Q, Z（相対コマンド m, l, c, q も絶対座標に変換）
  - H, V, S, T コマンドは対応コマンドに変換
  - A (Arc) コマンドは直線に近似（警告出力）
  - PathParser ユーティリティを追加
  - PathTool で直線パスを描画（Bキー）
  - Shift+クリックで3次ベジェ曲線セグメントを追加
  - 選択時にアンカーポイント（四角）と制御点（丸）のハンドル表示
  - 外部 SVG ファイル（PowerPoint等）のパス要素をインポート可能
  - サイドバーで d 属性を直接編集可能（パス選択時に表示）

### 削除
- BezierPath 機能を廃止し、Path に統合
  - 旧形式（data-shape-type="bezierPath"）は読み込み不可

### 変更

- SVG transform 属性対応
  - SVGファイル読み込み時に `translate` と `scale` 変換を解析・適用
  - グループ内グループのネストしたtransform合成に対応
  - 変換後は絶対座標として保持（書き出し時はtransformを使用しない）
  - 未対応変換（rotate, skewX, skewY, matrix）は警告ログ出力後に無視
  - TransformParser ユーティリティを追加

- Fit to Content 機能
  - 「Export Fit to Content...」メニュー（File）: 全オブジェクトを含む最小サイズでSVGをエクスポート
  - 「Fit Canvas to Content」メニュー（View）: キャンバスサイズを全オブジェクトにフィット
  - 図形を原点(0,0)付近に移動して最小サイズを実現
  - 余白設定: デフォルト20px、設定画面で変更可能（0〜100px）
  - Fit Canvas to Content は Undo/Redo 対応

- ベジェパス（3次ベジェ曲線）描画機能
  - クリックでアンカーポイントを順次配置
  - 開始点付近クリックで閉じたパス、ダブルクリックで開いたパス
  - Escapeキーでキャンセル
  - 選択時にアンカーポイント（四角）と制御点（丸）のハンドル表示
  - 制御点は独立して移動可能（角を作れる）
  - 制御線（破線）でアンカーと制御点の関係を表示
  - ツールバーボタン追加（Bキー）
  - Undo/Redo対応
  - SVG path要素として保存/読み込み

- グループ化機能
  - 複数の図形を選択してグループ化（Ctrl+G）
  - グループの解除（Ctrl+Shift+G）
  - グループ単位での移動・リサイズ
  - ネストしたグループのサポート
  - Undo/Redo対応（GroupShapesCommand/UngroupShapesCommand）
  - SVGファイルへの保存/読み込み（`<g data-group-type="group">` 形式）
  - グループ選択時に破線の境界ボックスと4隅のリサイズハンドル表示

- テキスト機能拡張
  - テキスト配置（text-anchor）: 左揃え/中央揃え/右揃え
  - 斜体（font-style: italic）
  - 下線（text-decoration: underline）
  - 取り消し線（text-decoration: line-through）
  - 複数行テキスト（改行対応、tspan要素でSVG出力）
  - 行の高さ調整（Line Height: 1.0/1.2/1.5/2.0）
  - サイドバーにスタイルボタン追加（B I U S）
  - Content入力をtextareaに変更（複数行入力対応）
  - Undo/Redo対応
  - ファイル保存/読み込み対応（後方互換性あり）

- キャンバスサイズ設定機能
  - キャンバスサイズ（幅×高さ）を指定可能
  - キャンバス範囲外はグレー色で表示
  - 範囲外にもオブジェクトを配置可能
  - 右下隅をドラッグしてリサイズ（青い円ハンドル）
  - 左上隅は常に座標(0,0)固定
  - サイドバーで数値入力による編集
  - Undo/Redo対応（CanvasResizeCommand）
  - ファイル保存/読み込み時にサイズを保持
  - デフォルトサイズ: 800 x 600
  - 最小サイズ: 100 x 100

- グリッド間隔設定機能
  - 設定画面でグリッド間隔を変更可能（5〜100px）
  - デフォルト: 10px
  - 設定変更後すぐにキャンバスに反映

- グラフ機能 Phase 1: 型定義とGraphManager基盤
  - ToolType に node, edge, delete-node, delete-edge を追加
  - ShapeType に node, edge を追加
  - EdgeDirection 型（none, forward, backward）
  - NodeData, EdgeData インターフェース
  - GraphManager クラス（ノード-エッジ関係管理）

- グラフ機能 Phase 2: ノード実装
  - Node シェイプ（楕円＋中央ラベル）
  - NodeTool（クリックでノード配置、ラベル入力ダイアログ）
  - NodeHandles（4隅リサイズハンドル）
  - AddNodeCommand（Undo/Redo対応）
  - ツールバーにノードボタン追加（Nキー）

- グラフ機能 Phase 3: エッジ基本実装
  - Edge シェイプ（直線・曲線・自己ループ対応）
  - EdgeTool（クリック/ドラッグでエッジ作成）
  - AddEdgeCommand（Undo/Redo対応）
  - 有向/無向エッジ切り替えボタン
  - GraphManager にノード移動時のエッジ更新機能追加
  - ツールバーにエッジボタン追加（Wキー）

- グラフ機能 Phase 4: ノード移動とエッジ連動
  - SelectTool 修正: ノード移動時に接続エッジを自動更新
  - ノードリサイズ時もエッジ位置を自動更新

- グラフ機能 Phase 5: 削除機能
  - DeleteNodeTool（クリックでノードと接続エッジを削除）
  - DeleteEdgeTool（クリックでエッジを削除）
  - DeleteNodeCommand/DeleteEdgeCommand（Undo/Redo対応）
  - 削除ホバー時の赤ハイライト表示

- グラフ機能 Phase 7: プロパティ編集
  - ノード選択時: ラベル、フォントサイズ編集
  - エッジ選択時: 方向（有向/無向）変更
  - NodeLabelChangeCommand/EdgeDirectionChangeCommand（Undo/Redo対応）

- グラフ機能 Phase 8: ファイル永続化
  - FileManager にノード/エッジのシリアライズ機能追加
  - ノード: `<g data-graph-type="node">` 形式でSVG保存
  - エッジ: `<path data-graph-type="edge">` 形式でSVG保存
  - data-* 属性でグラフ構造を保持（source-id, target-id, direction等）
  - ファイル読み込み時にGraphManager関係を再構築
  - ShapeFactory にNode/Edge対応追加
  - Edge.fromElement() 静的メソッド追加

- グラフ機能 Phase 9: ドキュメント更新
  - CLAUDE.md にグラフ機能のドキュメント追加
  - プロジェクト構造にグラフ関連ファイルを追加
  - キーボードショートカット（N, W）を追加
  - イベント一覧にグラフ関連イベントを追加
  - SVG保存形式の説明を追加

- グラフ自動レイアウト機能
  - cytoscape.js を使用したグラフ自動レイアウト
  - LayoutManager: cose (Force-directed) レイアウトアルゴリズム
  - ApplyLayoutCommand: Undo/Redo 対応
  - ツールバーに「Auto Layout」ボタン追加
  - レイアウト結果をキャンバス中央に配置

- 設定ダイアログ機能
  - アプリケーションメニュー追加（File, Edit, View）
  - Edit > Settings... で設定ダイアログを開く
  - 設定項目: 「起動時にスナップをONにする」
  - electron-store による設定の永続化
  - ウィンドウ位置・サイズの記憶と復元

- 位置・サイズ数値入力機能
  - サイドバーで選択オブジェクトの位置・サイズを数値入力で編集可能
  - Line: X1, Y1, X2, Y2
  - Ellipse: CX, CY, RX, RY
  - Rectangle: X, Y, W, H
  - Text: X, Y
  - Node: CX, CY, RX, RY
  - Undo/Redo対応（ResizeShapeCommand使用）
  - ドラッグ移動・リサイズ時にサイドバーの値をリアルタイム同期

- ノード配置サイズ設定機能
  - ノードツール選択時にサイドバーで配置するノードのサイズ（RX, RY）を設定可能
  - デフォルトサイズ: 20 x 20
  - 最小サイズ: 5

- 多角形（Polygon）描画機能
  - クリックで頂点を追加
  - 開始点付近をクリックまたはダブルクリックで図形を閉じる
  - Escapeキーでキャンセル
  - ツールバーボタン追加（Pキー）
  - 頂点ごとにリサイズハンドルで編集可能
  - SVG polygon要素として保存/読み込み

- ポリライン（Polyline）描画機能
  - クリックで頂点を追加
  - ダブルクリックまたはEnterキーで完了
  - Escapeキーでキャンセル
  - ツールバーボタン追加（Yキー）
  - 頂点ごとにリサイズハンドルで編集可能
  - SVG polyline要素として保存/読み込み

- 別名で保存機能とタイトルバー表示
  - 「別名で保存」(Save As) 機能を追加
  - ツールバーに「Save As」ボタン追加
  - メニュー File > Save As... (Ctrl+Shift+S)
  - タイトルバーに現在のファイル名を表示
  - 未保存の変更がある場合は * マークを表示
  - 新規ファイルは「Untitled」と表示
  - 既存ファイルの上書き保存は直接ファイルに保存

- ステータスバー機能
  - 画面下部にステータスバーを追加
  - マウスカーソルのXY座標をリアルタイム表示
  - 現在選択中のツール名を表示

- 新規作成機能と保存確認ダイアログ
  - 「新規作成」(New) 機能を追加 (Ctrl+N)
  - ツールバーに「New」ボタン追加
  - メニュー File > New
  - 未保存の変更がある場合、新規作成・ファイルを開く前に確認ダイアログを表示
  - アプリ終了時に未保存の変更がある場合、確認ダイアログを表示
  - 確認ダイアログで「保存」「保存しない」「キャンセル」を選択可能

- アプリケーションアイコン
  - グラフノード＋エッジ＋グリッドのデザイン
  - 描画中のカーソルと破線で「ドローツール」を表現
  - SVG、PNG（複数サイズ）、ICO形式で生成
  - npm run generate-icons でアイコン再生成可能

---

## [1.0.0] - 2026-01-05

### 追加
- 基本図形描画（直線、楕円、長方形、テキスト）
- 選択・移動・リサイズ機能
- Undo/Redo機能
- ファイル保存/読み込み（SVG形式）
- コピー/ペースト機能
- Z-Order（重ね順）制御
- ズーム・パン機能
- パンツールボタン
- グリッドスナップ機能
- 直線への矢印マーカー機能
